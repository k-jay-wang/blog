# 滴滴面试经过

## 笔试题

1. 给出以下代码的运行结果和时序

```javascript
console.log('start')
for(var i = 0; i < 5; i++) {
    setTimeout(function() {
        console.log(i)
    }, 1000)
};
console.log('stop');
// start stop 1000ms后 55555
```

问：为什么会这样？为什么不是12345的顺序？  
答：因为setTimeout是异步操作，执行顺序会放在同步操作之后，所以在1000ms后for里面执行的参数，拿到的都是已经完成循环的i，也就是5.  
问：那你怎么改一下让他变成01234？  
答：把var i 声明改成用let,变成块级作用域，这样就好了，或者使用一个闭包把变量传进去  
问：那你写一下闭包  
答：操了，在面试的时候把闭包写错了。

```javascript
console.log('start')
for(var i = 0; i < 5; i++) {
    (function(i) {setTimeout(function() {
        console.log(i)
    }, 1000)})(i)
};
console.log('stop');
```

问：那你说let是怎么作用的，能让它输出01234？  
答：~~我也不清楚块级作用域嘛就锁定了~~  
答：原因是：循环本身及5次timeout回调全部共享唯一的变量i，当循环结束时，i的值为5，此时回调被触发，所以会log5个5出来。以下是正文：  
let声明的变量拥有块级作用域，也就是说let声明的变量的作用域在for循环中不会共享同一个变量。  
2. 设计绑定事件，让每个li元素被点击时弹窗“这是第N个”

```html
<ul id="container">
<li>这是第一个</li>
<li>这是第二个</li>
<li>这是第三个</li>
<li>这是第四个</li>
<li>这是第五个</li>
<li>这是第六个</li>
</ul>
```

答：
代码这么写：

```js
const doms = document.getElementById('container').childNode;
for (let (dom, index) of doms) {
    dom.addEventListener('click', function() {
        alert('这是第' + index + '个')
    })
}
```

显然，不是最优解，要写成事件捕获的样子
问：那你要是有一万个li节点，一个一个绑定会不会太耗性能了？  
答：~~这不是废话？~~ 我知道要用事件捕获，但我忘记是不是可以拿到这是当前第几个节点了，其实，用事件捕获还真不知道是第几个元素。顺便一提：如果冒泡和捕获都到这个节点上触发了，哪个事件先注册，哪个事件就先执行，addeventListener(event, function, useCapture),第三个参数指代是否应用捕获，默认是false，也就是用冒泡，设置为true，则是指明用捕获，不用冒泡  
问：那你知道target和current target的区别吗？你有用过target吗？就是function拿到的target？  
答：不太清楚。
正解：LZZSCL，本来target也不知道他处于第几个位置啊，难道要我单纯的拿innerhtml？？要不要这么蠢啊兄弟，不过说回来，我写的也比较蠢，这个怪自己一波不过分。正解拿出来：

```js
const dom = document.getElementById('container');
dom.addEventListener('click', function(e) {
    if (e.target.nodeName.tolowerCase() == 'li') {
        alert(e.target.innerHTML)
    }
})
```

顺便补充target和currenttarget的区别：  
只读属性event.currentTarget 标识的是当事件沿着 DOM 触发时事件的当前目标。它总是指向事件绑定的元素，而 Event.target 则是事件触发的元素。  
意思很明确，外部UL绑定的点击事件，currenttarget就是ul，而li是执行click事件的元素，target指向的是这个li。  
问：那我看你这么写for循环，你的意思是所有数组都能用for循环？这个dom数组能循环吗？  
答：~~不能吗？数组有迭代器才能循环~~  
正解：因为node列表的类型是Nodelist, 和数组不一样，所以不可迭代  
问：那你平时用过什么for循环？  
答：就平时用的for,for in, for of, forEach,do while这样  
其实还有：数组高阶应用，map, every，reduce，keys，reduceRight  
reduce： reduce() 方法对数组中的每个元素执行一个由您提供的reducer函数(升序执行)，将其结果汇总为单个返回值。  
3. 实现一个元素块上下居中，左右居中，实现代码：

```css
item {
    width: 100px;
    height: 100px;
}
```

已知父元素宽高时可以通过position:absolute;实现。就是top:50%;margin-top: -50px;  
第二个也是绝对定位，margin全auto，top，left，right， bottom全0；  
第三个：当此元素为inline元素时，设置父容器为display:table-cell,然后设置text-align:center,vertical-align: middle就行  
第四个：flex，justify-content:center;align-items:center;完事  

问：那你知道有几种定位方式吗？  
答：人家想问的可能是：relative,absolute,fixed, static（默认是static），或者我觉得可以这么说：文档流布局，浮动布局，定位布局（绝对定位相对定位），flex布局  
4. 实现一个动画，让A元素围绕着B元素转 function (el, start, end,){}  
这个可真的不太懂，可能是用到requestAnimationFrame帧动画的东西了吧  
5. 实现简单的模板引擎，解析字符串{%className%}, {className: 'hehe'};
这个是正则处理的，我当时不知道正则咋写了，所以写的字符串处理，字符串处理我觉得也行吧，就是很蠢,这个正则记好了，以后就不会犯错了: /\{\{([^}]*)\}\}/g

```js
function compile(tpl, data) {
  const regex = /\{\{([^}]*)\}\}/g
  const string = tpl.trim().replace(regex, function(match, $1) {
    if ($1) {
      return data[$1]
    } else {
      return ''
    }
  })
  console.log(string) // <p>hello，我是hugo，职业：FE<p>
}

compile(tpl, data)
```

6. 考察this指向

```js
var a = 1;
function Fn1() {
    var a = 2;
    alert(this.a + a);
}
function Fn2() {
    var a = 3;
    Fn1();  // 输出什么？
}

var fn1 = new Fn1();
function Fn3() {
    this.a = 4;
    fn1.call(this)
}
```
